@{
    Layout = "~/Views/CancelApp/CancelAppTemplate.cshtml";
}

@{
    await Html.RenderPartialAsync("~/Views/CancelApp/QueryForm.cshtml");
}

@{
    await Html.RenderPartialAsync("~/Views/LcApp/LcDetailModal.cshtml");
    await Html.RenderPartialAsync("~/Views/LcApp/NoticeModal.cshtml");
}

<!-- 訊息 視窗 -->
@section Scripts
{
  <script>
    // 查詢控制項
    const searchBtn = document.querySelector('#searchBtn');
    const beneType = document.querySelector('#beneType');
    // 註銷申請/切結書欄位
    const appName = document.querySelector('#appName'); // 申請人
    const beneName = document.querySelector('#beneName'); // 受益人
    const cds = { app: '林大華', bene: '中鴻鋼鐵股份有限公司' };
    const fpc = { app: '石梅股份有限公司', bene: '台灣塑膠工業股份有限公司' };
    const other = { app: '網際優勢股份有限公司', bene: '網際優勢股份有限公司' };


    beneType.addEventListener('change', () => {
      currentEditType = beneType.value;
      if (currentEditType !== '0') {
        searchBtn.classList.remove('disabled');
      }
    });

    const queryForm = document.querySelector('#queryForm');
    const queryList = document.querySelector('#queryList');
    const lcForCdsAppList = document.querySelector('#lcForCdsAppList');
    const lcAppList = document.querySelector('#lcAppList');
    const lcforOtherAppList = document.querySelector('#lcforOtherAppList');

    // 編輯註銷申請/切結書 editHandler
    function editHandler() {
                var postData = {
                beneType: currentDataRow.benetype,
                lcNo: currentDataRow.lcno
                    };

                    $('').launchDownload('../CancelApp/CancelLcApp', postData);

    }

    // 確認 訊息及按鈕
    const messageModalLabel = document.querySelector('#messageModalLabel');
    const msgBody = document.querySelector('#msgBody');
    const msgFooter = document.querySelector('#msgFooter');
    

    // 月曆
    const dateAlert = document.querySelector(".dateAlert");
    const currentTime = new Date()
    const config = {
      locale: 'zh_tw',
      //enableTime: true, //可選時與分
      dateFormat: "Y/m/d", //時間格式
      time_24hr: true, //24 時制
      minuteIncrement: 15, //分鐘每次選擇間隔單位
      allowInput: true, //可輸入控制
      //minDate: "today", //可選最小時間，可直接接受 'today' 字串
      //maxDate: currentTime.setMonth(currentTime.getMonth() + 1), //可選最大時間，從今天起一個月
      onChange: function (selectedDates, dateStr, instance) {
        console.log(`你現在點選的是 ${instance.input.id}，時間為 ${selectedDates} / ${dateStr}`);
        checkDateTime(dateStr, instance.input.id);
      }
    };
    flatpickr('#startDate, #endDate', config);

    let startDateValue = null
    let endDateValue = null

    // 辨別結束日期須晚於開始日期
    function checkDateTime(dateStr, id) {
      if (id === "startDate") {
        startDateValue = dateStr
      }

      if (id === "endDate") {
        endDateValue = dateStr
      }

      if (startDateValue > endDateValue) {
        dateAlert.classList.remove("d-none");
      } else {
        dateAlert.classList.add("d-none");
      }
    };

    // 有效期限 / 最後交貨日期 / 限定押匯日期 - 日期選擇器
    flatpickr('#expDate, #deliveryDate, #draftDate', config);

  </script>
}